<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Formulario de Inscripción | DULCESOR</title>
  <meta name="description" content="Formulario de inscripción — I Concurso Internacional de Repostería Monacal “DULCESOR”." />
  <meta name="robots" content="index,follow" />

  <!-- (Opcional) reduce caché en navegadores/hosts intermedios -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <style>
    :root{
      --bg:#ffffff;
      --page:#ffffff;
      --ink:#1b1b1b;
      --muted:#6c6f75;
      --line:#e8eaee;
      --gold:#9b8340; /* dorado suave */
      --field:#f4f7ff; /* azul muy clarito como en tu captura */
      --danger:#b00020;
      --ok:#0e5b22;
      --radius:14px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--ink);
      background:linear-gradient(180deg,#ffffff 0%,#fbfbfd 100%);
    }
    header{
      background:var(--bg);
      border-bottom:1px solid var(--line);
    }
    header .wrap{
      max-width:980px;
      margin:0 auto;
      padding:14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    header a{
      color:var(--ink);
      text-decoration:none;
      font-weight:800;
      letter-spacing:.2px;
    }
    main{
      max-width:980px;
      margin:0 auto;
      padding:26px 16px 56px;
    }
    .card{
      background:var(--page);
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:20px;
      box-shadow:0 10px 28px rgba(0,0,0,.05);
    }

    h1{
      margin:0 0 18px;
      color:var(--gold);
      text-transform:uppercase;
      letter-spacing:.8px;
      font-size:1.35rem;
    }
    h2{
      margin:26px 0 14px;
      color:var(--gold);
      text-transform:uppercase;
      letter-spacing:.6px;
      font-size:1.08rem;
    }
    p{ margin:0 0 12px; line-height:1.45; }
    .muted{ color:var(--muted); }

    form{ margin-top:6px; }

    label{
      display:block;
      color:var(--gold);
      font-weight:650;
      margin:10px 0 6px;
    }

    input, textarea, select{
      width:100%;
      padding:11px 12px;
      border:1px solid var(--line);
      border-radius:12px;
      background:var(--field);
      color:var(--ink);
      outline:none;
      font-size:1rem;
    }
    textarea{ min-height:120px; resize:vertical; }
    input:focus, textarea:focus, select:focus{
      border-color:rgba(155,131,64,.55);
      box-shadow:0 0 0 4px rgba(155,131,64,.12);
      background:#fff;
    }

    .grid{
      display:grid;
      grid-template-columns:1fr;
      gap:12px;
    }
    @media (min-width:860px){
      .grid.two{ grid-template-columns:1fr 1fr; }
      .grid.three{ grid-template-columns:1fr 1fr 1fr; }
    }

    .checks{
      display:grid;
      gap:10px;
      margin-top:10px;
    }
    .check{
      display:flex;
      gap:10px;
      align-items:flex-start;
      color:var(--gold);
      font-weight:600;
    }
    .check input{
      width:20px;
      height:20px;
      margin-top:2px;
      accent-color:var(--gold);
      background:#fff;
    }

    .notice{
      margin-top:14px;
      padding:12px;
      border-radius:12px;
      border:1px solid var(--line);
      background:#fbfbfc;
      color:var(--muted);
    }
    .notice.error{
      border-color:#ffd1d1;
      background:#fff3f3;
      color:var(--danger);
      font-weight:650;
    }
    .notice.ok{
      border-color:#d1ffd9;
      background:#f3fff5;
      color:var(--ok);
      font-weight:650;
    }

    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:16px;
      align-items:center;
    }
    button{
      border:0;
      border-radius:12px;
      padding:12px 16px;
      background:var(--gold);
      color:#fff;
      font-weight:800;
      cursor:pointer;
      letter-spacing:.2px;
    }
    button.secondary{
      background:#e8eaee;
      color:#2a2a2a;
      font-weight:700;
    }
    button[disabled]{
      opacity:.55;
      cursor:not-allowed;
    }

    ol{
      margin:10px 0 12px 20px;
      color:var(--gold);
      line-height:1.45;
    }
    .bottom-row{
      display:grid;
      grid-template-columns:1fr;
      gap:12px;
    }
    @media (min-width:860px){
      .bottom-row{ grid-template-columns:1fr 1fr; }
    }

    .email{
      color:var(--gold);
      font-weight:900;
      word-break:break-word;
    }

    footer{
      max-width:980px;
      margin:0 auto;
      padding:18px 16px 32px;
      color:var(--muted);
      font-size:.95rem;
    }
    .req{
      color:var(--danger);
      font-weight:900;
      margin-left:6px;
    }
  </style>
</head>

<body>
<header>
  <div class="wrap">
    <a href="index.html" aria-label="Volver a inicio">DULCESOR</a>
    <a href="concursos.html">Concursos</a>
  </div>
</header>

<main>
  <div class="card">
    <h1>Formulario de inscripción</h1>
    <p class="muted">
      Rellena los campos del formulario. Al final podrás <strong>generar el correo</strong> para enviarlo a
      <span class="email">concurso@dulcesor.org</span> junto con la documentación requerida.
    </p>

    <p id="avisoCierre" class="notice error" style="display:none;"></p>

    <form id="formSolicitud" autocomplete="on" novalidate>
      <h2>Datos del convento o monasterio</h2>

      <label for="convento">NOMBRE DEL CONVENTO O MONASTERIO:<span class="req">*</span></label>
      <input id="convento" name="convento" required />

      <label for="madre">Nombre y Apellidos de la Madre Abadesa o Madre Superiora:<span class="req">*</span></label>
      <input id="madre" name="madre_abadesa_superiora" required />

      <label for="direccion">Dirección:<span class="req">*</span></label>
      <input id="direccion" name="direccion" required />

      <div class="grid two">
        <div>
          <label for="localidad">Localidad:<span class="req">*</span></label>
          <input id="localidad" name="localidad" required />
        </div>
        <div>
          <label for="cp">Código Postal:<span class="req">*</span></label>
          <input id="cp" name="codigo_postal" inputmode="numeric" required />
        </div>
      </div>

      <div class="grid two">
        <div>
          <label for="ccaa">Comunidad Autónoma:<span class="req">*</span></label>
          <input id="ccaa" name="comunidad_autonoma" required />
        </div>
        <div>
          <label for="pais">País:<span class="req">*</span></label>
          <input id="pais" name="pais" required value="España" />
        </div>
      </div>

      <div class="grid two">
        <div>
          <label for="telefono">Teléfono:<span class="req">*</span></label>
          <input id="telefono" name="telefono" type="tel" autocomplete="tel" required />
        </div>
        <div>
          <label for="correo">Correo:<span class="req">*</span></label>
          <input id="correo" name="correo" type="email" autocomplete="email" required />
        </div>
      </div>

      <label for="contacto">Persona de Contacto:<span class="req">*</span></label>
      <input id="contacto" name="persona_contacto" required />

      <h2>Datos de la participante</h2>

      <label for="part_nombre">Nombre, apellidos:<span class="req">*</span></label>
      <input id="part_nombre" name="participante_nombre_apellidos" required />

      <div class="grid two">
        <div>
          <label for="part_dni">DNI/NIE:<span class="req">*</span></label>
          <input id="part_dni" name="participante_dni_nie" required />
        </div>
        <div>
          <label for="part_edad">Edad:<span class="req">*</span></label>
          <input id="part_edad" name="participante_edad" type="number" min="0" step="1" inputmode="numeric" required />
        </div>
      </div>

      <h2>Datos de acompañante</h2>

      <label for="acomp_nombre">Nombre, apellidos:</label>
      <input id="acomp_nombre" name="acompanante_nombre_apellidos" />

      <div class="grid two">
        <div>
          <label for="acomp_dni">DNI/NIE</label>
          <input id="acomp_dni" name="acompanante_dni_nie" />
        </div>
        <div>
          <label for="acomp_edad">Edad</label>
          <input id="acomp_edad" name="acompanante_edad" type="number" min="0" step="1" inputmode="numeric" />
        </div>
      </div>

      <h2>Datos de la elaboración presentada</h2>

      <label for="denominacion">Denominación del dulce:<span class="req">*</span></label>
      <input id="denominacion" name="denominacion_dulce" required />

      <label for="descripcion">Breve descripción del producto:<span class="req">*</span></label>
      <textarea id="descripcion" name="breve_descripcion_producto" required></textarea>

      <label for="ingredientes">Listado de ingredientes utilizados (sin indicación de cantidades):<span class="req">*</span></label>
      <textarea id="ingredientes" name="ingredientes_sin_cantidades" required></textarea>

      <label for="proceso">Proceso de elaboración (descripción resumida):<span class="req">*</span></label>
      <textarea id="proceso" name="proceso_elaboracion" required></textarea>

      <label for="coste">Coste estimado de los ingredientes por unidad (€):<span class="req">*</span></label>
      <input id="coste" name="coste_estimado_ingredientes_unidad" inputmode="decimal" required placeholder="Ej: 1,85" />

      <h2>Documentación que se adjunta</h2>
      <div class="checks">
        <label class="check">
          <input type="checkbox" id="doc_foto" name="doc_fotografia_producto_final" />
          Fotografía del producto final
        </label>
        <label class="check">
          <input type="checkbox" id="doc_ficha" name="doc_ficha_inscripcion_cumplimentada" />
          Ficha de inscripción debidamente cumplimentada
        </label>
      </div>

      <h2>Declaración y aceptación</h2>
      <p class="muted">
        La abajo firmante solicita su inscripción en el I Concurso Internacional de Repostería Monacal “DULCESOR” y declara:
      </p>
      <ol>
        <li>Que conoce y acepta íntegramente el Reglamento que rige el concurso.</li>
        <li>Que la información facilitada es veraz y corresponde a una elaboración propia.</li>
        <li>
          Que autoriza a la organización a utilizar imágenes, denominación del dulce y datos generales de la elaboración
          con fines de difusión cultural y promocional del certamen, sin carácter comercial exclusivo.
        </li>
        <li>
          <strong>Protección de datos personales:</strong> De conformidad con el Reglamento (UE) 2016/679 (RGPD) y la Ley
          Orgánica 3/2018 (LOPDGDD), los datos personales facilitados serán tratados por la Asociación Cultural DULCESOR,
          como responsable del tratamiento, con la finalidad de gestionar la inscripción, participación y comunicación relacionada
          con el concurso. La base legal del tratamiento es el consentimiento de la persona interesada. Los datos no serán cedidos
          a terceros salvo obligación legal y se conservarán durante el tiempo necesario para la gestión del concurso y los plazos
          legalmente exigidos. Puede ejercer sus derechos de acceso, rectificación, supresión, oposición, limitación y portabilidad
          dirigiéndose a Plaza de Santa Ana, 4 – 47001 Valladolid o al correo electrónico <span class="email">concurso@dulcesor.org</span>.
        </li>
      </ol>

      <label class="check" style="margin-top:10px;">
        <input type="checkbox" id="rgpd" name="acepta_rgpd" required />
        He leído y acepto el tratamiento de mis datos personales conforme a la Política de Privacidad y las Bases del Concurso.
        <span class="req">*</span>
      </label>

      <div class="bottom-row">
        <div>
          <label for="lugar_fecha">Lugar y fecha:<span class="req">*</span></label>
          <input id="lugar_fecha" name="lugar_y_fecha" required placeholder="Ej: Valladolid, 12/05/2026" />
        </div>
        <div>
          <label for="firma">Firma de la participante (nombre completo):<span class="req">*</span></label>
          <input id="firma" name="firma_participante" required placeholder="Escribe el nombre completo" />
        </div>
      </div>

      <div id="estado" class="notice" style="display:none;"></div>

      <div class="actions">
        <button id="btnEnviarSolicitud" type="submit">ENVIAR SOLICITUD</button>
        <button class="secondary" type="button" id="btnCopiar">COPIAR TEXTO</button>
        <button class="secondary" type="reset">LIMPIAR</button>
      </div>

      <div class="notice" style="margin-top:16px;">
        <p style="margin:0;">
          <strong style="color:var(--gold);">Envío del formulario y documentación:</strong><br />
          El presente formulario deberá remitirse por correo electrónico a:
          <span class="email">concurso@dulcesor.org</span>
        </p>
        <p class="muted" style="margin-top:10px;">
          Importante: adjunta los archivos (foto del producto final y ficha de inscripción cumplimentada) en tu email.
        </p>
      </div>
    </form>
  </div>
</main>

<footer>
  © DULCESOR — Formulario de inscripción.
</footer>

<script>
  // ====== CIERRE AUTOMÁTICO DEL BOTÓN (30/05/2026 23:59:59 hora Madrid) ======
  // En esa fecha España suele estar en CEST (UTC+2), por tanto equivale a: 2026-05-30T21:59:59Z
  const DEADLINE_UTC_MS = Date.parse("2026-05-30T21:59:59Z");

  const form   = document.getElementById("formSolicitud");
  const btn    = document.getElementById("btnEnviarSolicitud");
  const aviso  = document.getElementById("avisoCierre");
  const estado = document.getElementById("estado");
  const btnCopiar = document.getElementById("btnCopiar");

  function aplicarCierreUI() {
    const cerrado = Date.now() >= DEADLINE_UTC_MS;
    btn.disabled = cerrado;

    aviso.style.display = cerrado ? "block" : "none";
    if (cerrado) {
      aviso.textContent = "Plazo cerrado: no se aceptan solicitudes después del 30/05/2026 23:59:59 (hora Madrid).";
    }
  }
  aplicarCierreUI();
  setInterval(aplicarCierreUI, 10_000);

  // ====== UTILIDADES ======
  function getFormDataObject() {
    const fd = new FormData(form);
    // normaliza checkboxes no marcados
    const checks = ["doc_fotografia_producto_final","doc_ficha_inscripcion_cumplimentada","acepta_rgpd"];
    checks.forEach(name => {
      if (!fd.has(name)) fd.set(name, "No");
      else fd.set(name, "Sí");
    });

    // convierte a objeto
    return Object.fromEntries(fd.entries());
  }

  function buildPlainText(data) {
    return [
      "FORMULARIO DE INSCRIPCIÓN — DULCESOR",
      "",
      "DATOS DEL CONVENTO O MONASTERIO",
      `- Nombre del convento o monasterio: ${data.convento || ""}`,
      `- Madre Abadesa / Superiora: ${data.madre_abadesa_superiora || ""}`,
      `- Dirección: ${data.direccion || ""}`,
      `- Localidad: ${data.localidad || ""}`,
      `- Código Postal: ${data.codigo_postal || ""}`,
      `- Comunidad Autónoma: ${data.comunidad_autonoma || ""}`,
      `- País: ${data.pais || ""}`,
      `- Teléfono: ${data.telefono || ""}`,
      `- Correo: ${data.correo || ""}`,
      `- Persona de contacto: ${data.persona_contacto || ""}`,
      "",
      "DATOS DE LA PARTICIPANTE",
      `- Nombre, apellidos: ${data.participante_nombre_apellidos || ""}`,
      `- DNI/NIE: ${data.participante_dni_nie || ""}`,
      `- Edad: ${data.participante_edad || ""}`,
      "",
      "DATOS DE ACOMPAÑANTE",
      `- Nombre, apellidos: ${data.acompanante_nombre_apellidos || ""}`,
      `- DNI/NIE: ${data.acompanante_dni_nie || ""}`,
      `- Edad: ${data.acompanante_edad || ""}`,
      "",
      "DATOS DE LA ELABORACIÓN PRESENTADA",
      `- Denominación del dulce: ${data.denominacion_dulce || ""}`,
      "",
      "Breve descripción del producto:",
      `${data.breve_descripcion_producto || ""}`,
      "",
      "Listado de ingredientes (sin cantidades):",
      `${data.ingredientes_sin_cantidades || ""}`,
      "",
      "Proceso de elaboración (resumido):",
      `${data.proceso_elaboracion || ""}`,
      "",
      `- Coste estimado ingredientes por unidad (€): ${data.coste_estimado_ingredientes_unidad || ""}`,
      "",
      "DOCUMENTACIÓN QUE SE ADJUNTA",
      `- Fotografía del producto final: ${data.doc_fotografia_producto_final || ""}`,
      `- Ficha de inscripción cumplimentada: ${data.doc_ficha_inscripcion_cumplimentada || ""}`,
      "",
      "DECLARACIÓN Y ACEPTACIÓN",
      `- Aceptación RGPD/Política de privacidad: ${data.acepta_rgpd || ""}`,
      `- Lugar y fecha: ${data.lugar_y_fecha || ""}`,
      `- Firma (nombre completo): ${data.firma_participante || ""}`,
      "",
      "Envío: concurso@dulcesor.org",
      "Nota: Adjuntar documentación requerida en el correo."
    ].join("\n");
  }

  function showStatus(type, text) {
    estado.className = "notice " + (type === "ok" ? "ok" : type === "error" ? "error" : "");
    estado.style.display = "block";
    estado.textContent = text;
  }

  function validateRequired() {
    // Validación HTML nativa (required, type=email, etc.)
    if (!form.checkValidity()) {
      form.reportValidity();
      return false;
    }
    return true;
  }

  // ====== COPIAR TEXTO ======
  btnCopiar.addEventListener("click", async () => {
    const data = getFormDataObject();
    const text = buildPlainText(data);

    try {
      await navigator.clipboard.writeText(text);
      showStatus("ok", "Texto copiado. Pégalo en tu correo y adjunta la documentación.");
    } catch {
      // fallback: selecciona en un prompt
      showStatus("error", "No se pudo copiar automáticamente. Prueba desde otro navegador o copia manualmente.");
    }
  });

  // ====== ENVIAR (GENERA CORREO) ======
  form.addEventListener("submit", (e) => {
    e.preventDefault();

    aplicarCierreUI();
    if (btn.disabled) {
      showStatus("error", "Plazo cerrado: no se puede enviar la solicitud.");
      return;
    }

    if (!validateRequired()) return;

    const data = getFormDataObject();
    const body = buildPlainText(data);

    // mailto (nota: algunos clientes limitan longitud; por eso también existe el botón COPIAR TEXTO)
    const subject = encodeURIComponent("Inscripción Concurso DULCESOR — " + (data.convento || "Solicitud"));
    const mailBody = encodeURIComponent(body);

    const mailto = `mailto:concurso@dulcesor.org?subject=${subject}&body=${mailBody}`;
    window.location.href = mailto;

    showStatus("ok", "Se ha abierto tu correo. Adjunta la documentación (foto + ficha) y envíalo.");
  });
</script>

</body>
</html>
